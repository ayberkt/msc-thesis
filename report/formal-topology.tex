\chapter{Formal topology}\label{chap:formal-topo}

We remarked that the motivation for pointless topology is to attain a constructive
understanding of topology, and that this is a prerequisite for being able to express
topology in type theory in a natural way, that is, without postulating classical axioms.
The task of making type-theoretical sense of topology presents another challenge: we must
be able to develop our results in a completely predicative way as well. To address this,
we will use formal topologies which give us a way of \emph{presenting} frames in a
predicative way. Instead of working with frames directly, we will work with formal
topologies from which the frames are generated. As the motivation for formal topology
arises naturally when attempting to carry out topology in type theory, it is fair to say
that formal topology is \emph{topology, construed type-theoretically}. This was aptly
pointed out by Giovanni Sambin~\cite{sambin-domains}:
\begin{quote}
  What is formal topology? A good approximation to the correct answer is: formal topology
  is topology as developed in (Martin-Löf's) type theory.
\end{quote}

Our definition of a formal topology will make use of the notion of an interaction system,
first formulated by Petersson and Synek~\cite{tree-sets}. In formulating this notion, the
motivation of Petersson and Synek was to generalise Martin-Löf's $\mathsf{W}$ types to be
able to accommodate mutual induction. Other names for interaction systems include
\emph{tree set constructors} (which is the name used by Petersson and
Synek~\cite{tree-sets}), and \emph{indexed containers}~\cite{indexed-containers}. The idea
of doing formal topology with interaction systems is due to Coquand~\cite{coq-posets} who
was inspired by Dragalin~\cite{dragalin}.

This chapter corresponds to several modules in the \veragda{} formalisation. Sections
\ref{sec:intr-sys} and \ref{sec:cover} correspond, respectively, to modules
\modname{FormalTopology} and \modname{Cover}. Sections \ref{sec:cover-nucleus} and
\ref{sec:lifting} correspond to the \modname{CoverFormsNucleus} module.
Section~\ref{sec:universal-prop} corresponds to the \modname{UniversalProperty} module.

\section{Interaction systems}\label{sec:intr-sys}

The fundamental idea of an interaction system is simple. Consider the progression of a
two-player game from the perspective of one of the two players. First, there is a type of
\emph{game states}; call it $A$:
\begin{equation*}
  A~:~\univ.
\end{equation*}
At each state $\oftyI{a}{A}$ of the game, there are certain moves the player can take.
Formally, this is a type parameterised by the type of game states:
\begin{equation*}
  \oftyI{B}{A \rightarrow \univ}.
\end{equation*}
Furthermore, for every move $b$ the player may take at state $a$, we can speak of the type
of counter-moves that the opponent may take in response. Formally, this is expressed as
a function:
\begin{equation*}
  \oftyI{C}{\pity{a}{A}{B(a) \rightarrow \univ}}.
\end{equation*}
Finally, given a counter-move $c$ in response to a certain move $b$ at some state $a$, we
proceed to a new game state. This is formally expressed by a function:
\begin{equation*}
  \oftyI{d}{\pity{a}{A}{\pity{b}{B(a)}{C(a, b) \rightarrow A}}}.
\end{equation*}

In four pieces, namely $(A, B, C, d)$, we characterise structures that involve some kind
of \emph{interaction}. Even though the game analogy is useful, interaction systems are
more general than games: they express anything that can be viewed as a \emph{dialogue}
i.e.~involving two parties interacting with each other.
Hancock~\cite{hancock-interaction-systems} provides a table of various structures that can
be viewed as interaction systems. We reproduce this (with minor notational modifications)
in Table~\ref{tab:hancock}.

\begin{table}[tbp]
  \centering
  \caption[Hancock's table of examples of interaction systems]{%
    Peter Hancock's~\cite{hancock-interaction-systems} table (with notational
    modifications) providing a list of examples of interaction systems.
  }
  \label{tab:hancock}
  \begin{tabular}{l l l l}
    $\oftyI{a}{A}$ & $\oftyI{b}{B(a)}$ & $\oftyI{c}{C(a, b)}$ & $\oftyI{d(a, b, c)}{A}$ \\\hline
    sort           & constructor       & selector             & component sort          \\
    statement      & inference         & premise              & premise statement       \\
    neighbourhood  & partition         & part                 & new neighbourhood       \\
    game           & attack            & defence              & new state               \\
    interrogation  & question          & answer               & new state               \\
    interface      & call              & return               & new state               \\
    universe       & observation       & reading              & new state               \\
    knowledge      & experience        & result               & new state               \\
    dialogue       & thesis            & antithesis           & synthesis               \\
  \end{tabular}
\end{table}

To define the notion of a formal topology, we will require the type $A$ of states to be
not just a set, but a poset. The idea is the same as in the case of frames: we would like
to view these states as stages of information ranked with respect to how refined they are;
in the case of a formal topology, however, these stages of information are \emph{basic} in
the sense of basis for a topological space. In the standard terminology of formal
topology, this is called a set of \emph{basic opens}~\cite{coq-sambin, palmgren, nlab-formal-topo}.
In addition, we will expect such a poset equipped with an interaction
system to satisfy the following two properties:
\begin{enumerate}
  \item the \textbf{monotonicity} property: for every state
    $\oftyI{a}{A}$, move $\oftyI{b}{B(a)}$ at state $a$, and counter-move $\oftyI{c}{C(a,
    b)}$ in response to $b$, $d(a, b, c) \sqsubseteq a$.
  \item the \textbf{simulation} property which states that at any state, we can simulate
    the previous states (in a sense that we will explain in detail later).
\end{enumerate}

Once we have imposed the requirement that the set of stages be a poset, it makes sense to
use some more suggestive terminology for referring to the components of an interaction
system due to Per Martin-Löf%
\footnote{%
  Attributed to Martin-Löf by Coquand~\cite[pg.~2]{coq-posets}.
}%
$^{,}$%
\footnote{%
  Although this terminology is due to Martin-Löf, it is the present author's opinion that
  it is particularly sensible to use this terminology in the context where we are imposing
  an ordering on the states that satisfies the monotonicity property. This terminology is
  freely used for \emph{all} interaction systems in the literature (as exemplified by
  Table~\ref{tab:hancock} as well). Our justification is that it makes no sense to call
  $B$ a type of experiments if the experiments might be \emph{taking away} existing
  knowledge i.e.~not satisfying the monotonicity property.
}
(though similar notions are common in the literature; see, for
instance,~\cite{philosophically-plausible}):
\begin{itemize}
  \item $A$: a type of stages of \emph{knowledge},
  \item $B$: a type of \emph{experiments} that one can perform at a certain stage of
    knowledge $a$,
  \item $C$: a type of \emph{outcomes} of an experiment $\oftyI{b}{B(a)}$ at some stage of
    knowledge $a$, and
  \item $d$: a function that expresses the act of \emph{revising} one's knowledge state
    based on the outcome of an experiment performed at a stage of knowledge.
\end{itemize}

Once we adopt this view, what the monotonicity property says becomes much clearer: if we
perform an experiment $b$ while we have knowledge $a$ and revise our knowledge based on
some outcome $c$ of $b$, the new state of knowledge we arrive at must contain at least as
much information as does $a$.

Now, to proceed towards the definition of a formal topology, let us first formally define
interaction systems.
\begin{defn}[Interaction system]\label{defn:intr-sys}
  For simplicity, we will require all types to be at the same level and omit the level
  in the notation.
  \begin{align*}
    \treestr{A} &\quad\is\quad
      \sigmaty{B}{A \rightarrow \univ}{
        \sigmaty{C}{\pity{a}{A}{B(a) \rightarrow \univ{}}}{
          \pity{a}{A}{\pity{b}{B(a)}{C(a, b) \rightarrow A}}
        }
      }\\
    \intrsys{} &\quad\is\quad \sigmaty{A}{~~~~\univ}{\treestr{A}}
  \end{align*}
  Given an interaction system $\mathcal{I}$, we will refer to its components as
  $A_{\mathcal{I}}$, $B_{\mathcal{I}}$, $C_{\mathcal{I}}$, and $d_{\mathcal{I}}$ in
  contexts where the possibility of ambiguity is present.
\end{defn}

\begin{agdanotation}
  In the \veragda{} formalisation, $A$, $B$, $C$, and $d$ are called respectively
  \fnname{state}, \fnname{action}, \fnname{reaction}, and \fnname{δ}. Furthermore,
  arguments that can be inferred have been made implicit. For \fnname{\delta}, for instance,
  the stage and the experiment can be inferred from the outcome so, given an outcome
  $\oftyI{c}{C(a, b)}$, we write $\fnname{\delta}~c$ in \veragda{} for what we express here as
  $d(a, b, c)$.
\end{agdanotation}

Given an interaction system $\mathcal{I}$, the monotonicity property is then
formally expressed as given in the following definition.
\begin{defn}[Monotonicity property of an interaction system]\label{defn:mono}
  An interaction system $\mathcal{I}$, whose type $A_{\mathcal{I}}$ of stages is equipped
  with a partial order, is said to have the monotonicity property if the following type is
  inhabited:
  \begin{alignat*}{2}
    \hasmononm{} \quad&:\quad &&\left( \sigmaty{P}{\poset{}}{\treestr{\abs{P}}} \right) \rightarrow \univ{} \\
    \hasmono{P, \mathcal{I}} \quad&\is\quad
    &&\pity{a}{A_{\mathcal{I}}}{%
        \pity{b}{B_{\mathcal{I}}(a)}{%
          \pity{c}{C_{\mathcal{I}}(a, b)}{%
              d(a, b, c) \sqsubseteq_P a
          }
        }
      }.
  \end{alignat*}
\end{defn}

We have not yet fully explained the simulation property so let us now address that. We
first provide its formal definition.
\begin{defn}[Simulation property]\label{defn:sim}
  Given an interaction system $\mathcal{I}$, whose type $A_{\mathcal{I}}$ of stages is a
  poset, we will say that it satisfies the simulation property if the following type is
  inhabited:
  \begin{align*}
    &\hassim{\mathcal{I}, \sqsubseteq} \quad\is \\
    &\hspace{2em}\pity{a'~a}{A}{%
      a' \sqsubseteq a \rightarrow\\
      &\hspace{4em}\pity{b}{B(a)}{
        \sigmaty{b'}{B(a')}{
          \pity{c'}{C(a', b')}{
            \sigmaty{c}{C(a, b)}{
              d(a', b', c') \sqsubseteq d(a, b, c)
            }
          }
        }
      }
    }.
  \end{align*}
\end{defn}

What does this say intuitively? Let us use the terminology of ``below'' and ``above'' for
referring to finer and coarser stages of information. The simulation property then says
that at any stage, we can always find a counterpart to any experiment from a stage
above---``counterpart'' in the sense that \emph{any} outcome of that experiment can be
mapped to \emph{some} outcome of the above experiment and that this experiment will lead
to a stage below the one given by the outcome of the experiment above. In other words, as
we choose to perform certain experiments and proceed to more refined stages, we do not
lose the ability to perform the experiments we previously chose not to perform: there is
always a corresponding experiment ($b'$) that will get us to a stage that is at least as
refined as the one we can reach from the less refined stage.

We are now ready to formally define the notion of a formal topology.
\begin{defn}[Formal topology]\label{defn:formal-topo}
  A \emph{formal topology} is simply an interaction system on a poset $P$ of stages
  that satisfies the monotonicity and simulation properties:
  \begin{align*}
    \formaltopo{}_{m, n} \quad\is\quad \sigmaty{P}{\poset{}_{m, n}}{%
      \sigmaty{\mathcal{I}}{\treestr{\abs{P}}}
        \hasmono{\mathcal{I}, \sqsubseteq_P} \times \hassim{\mathcal{I}, \sqsubseteq_P}
    }.
  \end{align*}
\end{defn}

\section{Cover relation}\label{sec:cover}

The real reason we are interested in formal topologies is that the structure they contain,
along with the \vermono{} and \versim{} properties, induces a well-behaved
\emph{cover~relation}. This is a method going back to
Johnstone's~\cite[pg.~57,~II.2.11]{stone-spaces} adaptation of the notion of a
Grothendieck topology~\cite{SGA4} to the context of locale theory, that was subsequently
developed by Martin-L\"{o}f and Sambin~\cite{int-formal-spaces}. The idea of defining the
cover as an inductive type originated in the joint work of Coquand, Sambin, et
al.~\cite{coq-sambin}.

The idea is as follows: given a set $A$ that we view like a set of \emph{basic opens}, we
require a relation:
\begin{equation*}
  \_\covernm{}\_ : A \rightarrow \pow{A} \rightarrow \hprop{}
\end{equation*}
that is expected to pointlessly express the relation of being an \emph{open cover} i.e.,
$x \covernm{} U$ iff $U$ is an open cover of $x$: $x = \bigvee_i U_i$. In other words, we are
specifying which basic opens can be expressed as the join of which others. The information
contained by this relation is sufficient to generate the topology (i.e.~the frame).

The original formulation of formal topology by Sambin suffers a particular problem: it is
not known how to define, predicatively, the coproduct of two frames using it. This problem
was solved by Coquand, Sambin et al.~\cite{coq-sambin} by defining the cover relation
inductively. We follow this approach in our development. In fact, as we will explain
later, we will define this relation not just as an inductive type but as a \emph{higher}
inductive one.

We now proceed to define the cover relation on a given formal topology. Our presentation
will recapitulate the progression of our development: we first explain our naive attempt,
which we found out not to work in univalent type theory, and after that its remedied form
(thanks to a (privately communicated) suggestion by Thierry Coquand) that circumvents this
problem through the use of HITs.
\begin{defn}[Naive cover relation]\label{defn:naive-cover}
  Given a formal topology
  $\mathcal{F}$ on type $A$, and given $\oftyI{a}{A}$, $U : \pow{A}$, the type
  $\covers{a}{U}$ is inductively defined with the following two constructors.
  \[
  \begin{prooftree}
    \hypo{ a \mempownm U }
    \infer1[$\ruledir{}$]{\covers{a}{U}}
  \end{prooftree}
  \qquad
  \begin{prooftree}
    \hypo{\oftyI{b}{B(a)}}
    \hypo{\pity{c}{C(a, b)}{\covers{d(a, b, c)}{U}}}
    \infer2[$\rulebranch{}$]{\covers{a}{U}}
  \end{prooftree}
  \]
  To emphasise the reading of these constructors as proof rules, we write them as rule
  names and refer to them as rules.
\end{defn}

One way of reading $\covers{a}{U}$ is as a relaxation of $a \mempownm U$ to ``it is
eventually the case that $a \mempownm U$'' if one views the refining of $a$ as an evolution over
time. In other words, it might not be that $a \mempownm U$ but once stage $a$ has been reached,
all paths that do not lead to $U$ have been ruled out: regardless of what experiments are
run, they will eventually lead to a stage in $U$.

Let us now turn our attention to the question of how to present a frame using the cover
relation of a formal topology. The cover relation has the following type:
\begin{equation*}
  \_\covernm{}\_ : A \rightarrow \pow{A} \rightarrow \univ{},
\end{equation*}
which we can flip to get
\begin{equation*}
  \_\RHD\_ : \pow{A} \rightarrow A \rightarrow \univ{}.
\end{equation*}
\emph{If only} this had the result type $\hprop{}$ rather than $\univ{}$, we would have
been able to write it like:
\begin{equation}\label{eqn:expected-cover-type}
  \_\RHD\_ : \pow{A} \rightarrow \pow{A},
\end{equation}
but this is not the case as the relation has been defined using more than one constructor:
it can have multiple, distinct proofs. If (\ref{eqn:expected-cover-type}) were the case,
we could at least try restricting it to get an endofunction on the set of downwards-closed
subsets:
\begin{equation*}
  \_\RHD\_ : \dcsubset{A} \rightarrow \dcsubset{A}
\end{equation*}
which (we believe) could then be shown to be a nucleus. (\ref{eqn:expected-cover-type}),
however, is not the case so we first have to deal with this problem.

It is tempting to try to achieve this by truncating $\covers{\_}{\_}$. When we do this,
however, it becomes impossible (ostensibly) to prove the idempotence law for the purported
nucleus $\RHD : \dcsubset{A} \rightarrow \dcsubset{A}$. Why exactly is that? If we were to work with
the truncated form of $\covernm{}$ (as defined in Defn.~\ref{defn:naive-cover}), the
idempotence law would look like:
\begin{equation*}
  \trunc{\covers{a}{\trunc{\lambda x.~\covers{x}{U}}}} \rightarrow \trunc{\covers{a}{U}}.
\end{equation*}
In our attempt to prove this, we had to use a lemma saying given any $a$, and subsets
$U, V$,
\begin{center}
  if $\trunc{\covers{a}{U}}$ and $\trunc{\covers{a'}{V}}$ for every $\mempow{a'}{U}$, then
  $\trunc{\covers{a}{V}}$.
\end{center}
It is perhaps possible to avoid using such a lemma, but we have not been able to achieve
this; we therefore believe that such a lemma would be necessarily needed.

The $\ruledir{}$ case of this lemma is easily verified. The $\rulebranch{}$ case, however,
results in a situation where we are trying to show
\begin{equation*}
  \trunc{\pity{c}{C(a, b)}{\covers{d(a, b, c)}{V}}}
\end{equation*}
whereas all we get from the inductive hypothesis is
\begin{equation*}
  \pity{c}{C(a, b)}{\trunc{\covers{d(a, b, c)}{V}}}.
\end{equation*}
An inference of the former from the latter would most likely require the use of a
classical reasoning principle looking a lot like the axiom of
choice~\cite[pg.~119, Lemma~3.8.2]{hottbook}:
\begin{equation*}
  \left( \pity{x}{A}{\trunc{B(x)}} \right) \rightarrow \trunc{\pity{x}{A}{B(x)}},
\end{equation*}
with the difference that neither $A$ nor $B$ are required to be h-sets. Notice at this
point that this not just not provable in type theory, but is in fact
\emph{provably false}~\cite[pg.~120, Lemma~3.8.5]{hottbook}!

We would like to clarify at this point that we have not proven the fact that the
idempotence law is not provable without this (generalised) choice axiom: we have merely
\emph{failed} to prove it. We conjecture, however, that it is not provable. At the time
of writing, no answer to this question has been found.

To remedy this, we will refrain from truncating the naive form of the cover relation, and
we will instead add a path constructor that \emph{squashes} the difference between the
$\ruledir{}$ and $\rulebranch{}$ constructors. The observation that the choice principle
is no longer needed when the covering relation is defined this way is due to Coquand. We
now provide the revised form, repeating the rules from Defn.~\ref{defn:naive-cover} for
the sake of self-containment.
\begin{defn}[Cover relation]\label{defn:covering}
  Given a formal topology
  $\mathcal{F}$ on type $A$, and given $\oftyI{a}{A}$, $U : \pow{A}$, the type
  $\covers{a}{U}$ is inductively defined with the following two constructors:
  \[
  \begin{prooftree}
    \hypo{ a \mempownm U }
    \infer1[$\ruledir{}$]{\covers{a}{U}}
  \end{prooftree}
  \qquad
  \begin{prooftree}
    \hypo{\oftyI{b}{B(a)}}
    \hypo{\pity{c}{C(a, b)}{\covers{d(a, b, c)}{U}}}
    \infer2[$\rulebranch{}$.]{\covers{a}{U}}
  \end{prooftree}
  \]
  In addition to the constructors, the type $\covers{a}{U}$ contains the following
  family of paths:
  \begin{equation*}
    \begin{prooftree}
      \hypo{\oftyI{p}{\covers{a}{U}}}
      \hypo{\oftyI{q}{\covers{a}{U}}}
      \infer2[$\rulesquash{}$.]{p = q}
    \end{prooftree}
  \end{equation*}
\end{defn}

\begin{agdanotation}
  The definition of this cover relation can be found in the \modname{Cover} module in the
  \veragda{} formalisation and is denoted {\color{AgdaDatatype}\fnname{◁}}. Notice also
  that Defn.~\ref{defn:naive-cover} is not present in the \veragda{} code.
\end{agdanotation}

We note that a similar idea is employed in the construction of the Cauchy reals as a
higher inductive-inductive type in the HoTT Book~\cite[Defn.~11.3.2]{hottbook}. Here, a
path constructor is used to avoid using the axiom of countable choice. Given that the
topology of the real numbers is a prime example of a topology, it is perhaps not a
coincidence that the need to use a similar trick arises when one sets out to investigate
topology in univalent type theory. It is an interesting direction for further work to
investigate the relation between these, for instance by defining the formal topology of
the real numbers.

When trying to prove the idempotence law with this, we get from the inductive hypothesis a
product $\pity{c}{C(a, b)}{\covers{d(a, b, c)}{V}}$ where $\covers{d(a, b, c)}{V}$ is
still ``squashed'', but this squashing is an integral part of $\covers{\_}{\_}$ rather
than a truncation that is imposed extrinsically upon it. This is sufficient for
circumventing the problem that would have required a form of choice, and allows us to
successfully complete the idempotence proof. The type of $\RHD$ can be seen
\emph{directly} to be $\pow{A} \rightarrow \pow{A}$ by the existence of the $\rulesquash{}$
constructor.

We can now restrict $\pow{A}$ to $\dcsubset{A}$ since, given a downwards-closed subset
$\oftyI{U}{\pow{A}}$, the subset of elements that are covered by $U$ (i.e.,
$\covers{\_}{U}$) is itself downwards-closed.

We now prove some crucial properties of the cover relation, starting with
down\-wards-closure.

\begin{prop}\label{prop:lem1}
  Given a formal topology $\McF{}$, $\oftyII{a}{a'}{A_{\McF{}}}$ such that $a' \sqsubseteq a$, and a
  downwards-closed subset $U$ of $A_{\McF{}}$, if $\covers{a}{U}$ then $\covers{a'}{U}$.
\end{prop}
\begin{proof}
  Let $\oftyII{a}{a'}{A}$ such that $a' \sqsubseteq a$ and $\covers{a}{U}$. We need to show
  $\covers{a'}{U}$. Our proof proceeds by (higher) induction on the proof of
  $\covers{a}{U}$.
  \begin{itemize}
    \item Case $\ruledir{}$. It must be that $a \mempownm U$ and hence, by the
      downwards-closure of $U$, $a' \mempownm U$ meaning $\covers{a'}{U}$ by $\ruledir{}$.
    \item Case $\rulebranch{}$. We have some experiment $b$ on $a$ and a function
      $$\oftyI{f}{\pity{c}{C(a, b)}{\covers{d(a, b, c)}{U}}}.$$ Using the $\rulebranch{}$
      rule, we are done if we can exhibit some experiment $\oftyI{b'}{B(a')}$ along with a
      function
      \begin{equation*}
        \oftyI{g}{\pity{c'}{C(a', b')}{\covers{d(a', b', c')}{U}}}.
      \end{equation*}
      Pick $b'$ to be the experiment obtained by appealing to the simulation property
      (Defn.~\ref{defn:sim}) with $b$. Let $\oftyI{c'}{C(a', b')}$. It remains to be shown
      that $\covers{d(a', b', c')}{U}$. The simulation property gives us some outcome
      $\oftyI{c}{C(a, b)}$ such that $d(a', b', c') \sqsubseteq d(a, b, c)$.
      The result follows by appealing to the inductive hypothesis
      with proof $\oftyI{f(c)}{\covers{d(a, b, c)}{U}}$ along with the fact that
      $d(a', b', c') \sqsubseteq d(a, b, c)$.
    \item Case $\rulesquash{}$. We are done by the $\rulesquash{}$ rule.
  \end{itemize}
\end{proof}

\begin{prop}\label{prop:lem2}
  Let $\McF{}$ be a formal topology with cover relation $\covernm{}$, and let
  $\oftyII{U}{V}{\pow{A_{\McF{}}}}$ be subsets of $A_{\McF{}}$ such that $V$ is
  downwards-closed. For any $\oftyI{a}{A_{\McF{}}}$, if $\covers{a}{U}$ and
  $\mempow{a}{V}$, then $\covers{a}{\intersect{U}{V}}$.
\end{prop}
\begin{proof}
  Let $\oftyI{a}{A_{\McF{}}}$ such $\covers{a}{U}$ and $a \mempownm V$. We proceed by
  induction on the proof of $\covers{a}{U}$.
  \begin{itemize}
    \item Case $\ruledir{}$. We have $\mempow{a}{U}$ and $\mempow{a}{V}$ so we are done by
      the $\ruledir{}$ rule.
    \item Case $\rulebranch{}$. We have some experiment $\oftyI{b}{a}$ such that
      $\covers{d(a, b, c)}{U}$ for every outcome $\oftyI{c}{C(a, b)}$. We are done by the
      $\rulebranch{}$ rule on $b$ if we can show that
      $\covers{d(a, b, c)}{\intersect{U}{V}}$ for every $\oftyI{c}{C(a, b)}$.
      Let $\oftyI{c}{C(a, b)}$. Notice that $d(a, b, c) \sqsubseteq a$ by the monotonicity property
      (Defn.~\ref{defn:mono}) and hence by the downwards-closure of $V$, we have
      $\mempow{d(a, b, c)}{V}$. This means that we have $\covers{d(a, b, c)}{U}$ and
      $\mempow{d(a, b, c)}{V}$ so we are done by the inductive hypothesis.
    \item Case $\rulesquash{}$. Immediate by the $\rulesquash{}$ rule.
  \end{itemize}
\end{proof}

\begin{prop}\label{prop:lem3}
  Given a formal topology $\McF{}$, $\oftyII{a}{a'}{A_{\McF{}}}$ such that $a' \sqsubseteq a$, and
  downwards-closed subsets $U$ and $V$ of $A_{\McF{}}$, if $\covers{a}{U}$ and
  $\covers{a'}{V}$ then $\covers{a'}{V \cap U}$.
\end{prop}
\begin{proof}
  Let $\oftyII{a}{a'}{A_{\McF{}}}$ such that $a' \sqsubseteq a$ and assume $\covers{a}{U}$ and
  $\covers{a'}{V}$. We need to show that $\covers{a'}{\intersect{V}{U}}$. We proceed by
  induction on the proof of $\covers{a'}{U}$.
  \begin{itemize}
    \item Case $\ruledir{}$. We have $\mempow{a}{U}$ and hence $\mempow{a'}{U}$ by the
      downwards-closure of $U$. The result then follows directly by Prop.~\ref{prop:lem2}.
    \item Case $\rulebranch{}$. We have some experiment $\oftyI{b}{a}$ such that
      $\covers{d(a, b, c)}{U}$ for every outcome $\oftyI{c}{C(a, b)}$. By the
      $\rulebranch{}$ rule, we are done if can exhibit some experiment $\oftyI{b'}{B(a')}$
      such that $\covers{d(a', b', c')}{\intersect{V}{U}}$ for every $\oftyI{c'}{C(a',
        b')}$. We choose the $b'$ given by the simulation property. Let $\oftyI{c'}{C(a',
        b')}$. Notice that $d(a', b', c') \sqsubseteq a'$ by monotonicity. This means, by the
      downwards-closure of $\covers{\_}{V}$ (Prop.~\ref{prop:lem1}), that
      $\covers{d(a', b', c')}{V}$. It suffices, then, by the inductive hypothesis on
      $d(a, b, c)$, $d(a', b', c')$, and the proof of $\covers{d(a, b, c)}{U}$ to show
      $d(a', b', c') \sqsubseteq d(a, b, c)$. This is precisely what the simulation property gives
      us.
    \item Case $\rulesquash{}$. We are done by the $\rulesquash{}$ rule.
  \end{itemize}
\end{proof}

\begin{prop}\label{prop:lem4}
  Let $\mathcal{F}$ be a formal topology and $U, V$ be subsets of its underlying poset. If
  $U \subseteq \covers{\_}{V}$ then $\covers{\_}{U} \subseteq \covers{\_}{V}$.
\end{prop}
\begin{proof}[Proof sketch]
  By induction on the covering proof. The $\ruledir{}$ case is direct by assumption. The
  $\rulebranch{}$ case follows by the $\rulebranch{}$ rule with a direct appeal to the
  inductive hypothesis. The $\rulesquash{}$ case follows by the $\rulesquash{}$ rule.
\end{proof}

Let us now summarise our method for generating a frame out of a formal topology which
comprises four steps.
\begin{enumerate}
  \item Start with a formal topology $\McF{}$.
  \item $\McF{}$ has an underlying poset $P$; construct its frame of downwards-closed
    subsets $\dcframe{P}$ (as given in Theorem~\ref{thm:down-set-frame}).
  \item Note: $\covers{\_}{\_}$ is a nucleus on $\dcframe{P}$.
  \item We have shown (in Theorem~\ref{thm:fixed-point-frame}) that the set of
    fixed points for every nucleus is a frame. The generated frame is the frame of
    elements of $\dcframe{P}$ that are fixed points for $\covers{\_}{\_}$
    $\fix{\dcframe{P}}{\RHD}$.
\end{enumerate}
The only missing step is (3): we have not yet shown that the covering relation is a
nucleus. We will do exactly this in Sec.~\ref{sec:cover-nucleus}.

\section{Covers are nuclei}\label{sec:cover-nucleus}

$\_\RHD\_ : \pow{A} \rightarrow \pow{A}$ is an endofunction on the powerset of $A$. By restricting
our attention to subsets that are downwards-closed, we can view this as an endofunction on
the frame of downwards-closed subsets:
\begin{equation*}
  \oftyI{\_\RHD\_}{\dcsubset{A} \rightarrow \dcsubset{A}}.
\end{equation*}
The natural question to be asked is then: is this a nucleus (Defn.~\ref{defn:nucleus}) on
the frame of downwards-closed subsets of $A$? Let us recapitulate what this means before
we answer the question positively. Let $U$ and $V$ be downwards-closed subsets of a
formal topology;
\begin{itemize}
  \item $N_0$: $\pity{a}{A}{\covers{a}{(\intersect{U}{V})} = \intersect{(\covers{a}{U})}{(\covers{a}{V})}}$,
  \item $N_1$: $U \subseteq \_ \covernm{} U$, and
  \item $N_2$: $\_ \covernm{} (\_ \covernm{} U) \subseteq \_ \covernm{} U$.
\end{itemize}

\begin{thm}\label{thm:covering-nucleus}
  Let $\McF{}$ be a formal topology with an underlying poset $P$. The covering relation of
  $\McF{}$ (defined in Defn.~\ref{defn:covering}) is a nucleus on $\dcframe{P}$.
\end{thm}
\begin{proof}
  $N_1$ is direct using the $\ruledir{}$ rule. $N_2$ is a direct application of
  Prop.~\ref{prop:lem4}.

  For $N_0$, let $\oftyII{U}{V}{\dcsubset{\abs{P}}}$ be downwards-closed subsets. We will
  show
  \begin{equation*}
    \_ \covernm{} (\intersect{U}{V}) \quad=\quad \intersect{(\_ \covernm{} U)}{(\_ \covernm{} V)}
  \end{equation*}
  by antisymmetry. The
  $\subsetof{\intersect{(\covers{\_}{U})}{(\_ \covernm{} V)}}{\covers{\_}{(\intersect{U}{V})}}$
  direction follows directly by Proposition~\ref{prop:lem3}. For the other direction, let
  $\oftyI{a}{A}$ such that $\covers{a}{\intersect{U}{V}}$. We proceed by induction on this
  proof.
  \begin{itemize}
    \item Case $\ruledir{}$. $a \mempownm \intersect{U}{V}$ meaning $\mempow{a}{U}$ and
      $\mempow{a}{V}$ hence we are done by two applications of $\ruledir{}$.
    \item Case $\rulebranch{}$. Follows by two uses of the $\rulebranch{}$ rule on two
      conjuncts of the inductive hypothesis.
    \item Case $\rulesquash{}$. We get two proofs of $\covers{a}{\intersect{U}{V}}$ and we
      use the inductive hypothesis on both. We combine the results' left conjuncts and
      right conjuncts by using the $\rulesquash{}$ rule twice.
  \end{itemize}
\end{proof}

\section{Lifting into the generated frame}\label{sec:lifting}

Now that we have shown the nuclearity of the covering relation $\covers{\_}{\_}$, we have
everything we need for the procedure of generating a frame from a formal topology.

Let $\McF{}$ be a formal topology with underlying poset $P$. We know by
Theorem~\ref{thm:down-set-frame} that the set of downwards-closed subsets of the
underlying poset of $\McF{}$ is a frame; denote this by $\dcframe{P}$. As we know that
$\RHD$ is a nucleus on this frame (by Theorem~\ref{thm:covering-nucleus}), we know that
the set of fixed points for $\RHD$ is a frame as well; we denote this
$\fix{\dcframe{P}}{\RHD}$. Now, notice that we can define a lifting map
$\eta : \abs{P} \rightarrow \fix{\dcframe{P}}{\RHD}$ as follows:
\begin{align*}
  \eta    \quad&:\quad \abs{P} \rightarrow \pow{A_{\McF{}}}\\
  \eta(a) \quad&\is\quad \covers{\_}{\lifta{a}}
\end{align*}
where $\lifta{a}$ denotes the \emph{downwards-closure} of $a$: $\{ a'~|~a' \sqsubseteq a \}$. So $a'
\mempownm \eta(a) \equiv \covers{a'}{\lifta{a}}$ is to say ``$a'$ eventually evolves into a stage that $a$
evolves into'' if we take the reading of stages of knowledge being refined over time. As
we have proven in Prop.~\ref{prop:lem1}, $\eta(x)$ is downwards-closed. It is also a fixed
point for $\covernm{}$, as we will show, so its type can be refined to $\oftyI{\eta}{\abs{P}
  \rightarrow \fix{\dcframe{P}}{\RHD}}$.

\begin{defn}[$\eta$]
  Let $\McF{}$ be a formal topology with underlying poset $P$ (note: $\abs{P} \equiv
  A_{\McF{}}$) and cover relation $\covers{\_}{\_}$. There exists a monotonic map from $P$
  to the underlying poset of $\fix{\dcframe{P}}{\RHD}$, defined as:
  \begin{align*}
    \eta    \quad&:\quad \mono{P}{\fix{\dcframe{\abs{P}}}{\RHD}}\\
    \eta(a) \quad&\is\quad \covers{\_}{\lifta{a}}.
  \end{align*}
  The fact that $\eta$ is monotonic follows from Proposition~\ref{prop:lem1}. It remains to
  be shown that $\eta(a)$ is a fixed point of $\covernm$ for every $\oftyI{a}{A_{\McF{}}}$.
  Let $\oftyI{a}{A_{\McF{}}}$. We need to show $\covers{\_}{(\covers{\_}{\lifta{a}})} =
  \covers{\_}{\lifta{a}}$. We proceed by antisymmetry. $\covers{\_}{\lifta{a}} \subseteq
  \covers{\_}{(\covers{\_}{\lifta{a}})}$ follows by $N_1$. The other direction is a direct
  application of Proposition~\ref{prop:lem4}.
\end{defn}

\section{Formal topologies present}\label{sec:universal-prop}

We are now ready to shift our focus on what can be called main theorem of this thesis:
formal topologies, as we have defined them, present frames as expected. Let $\mathcal{F}$
be a formal topology and $F$ a frame. Consider a monotonic function $f : A_{\mathcal{F}} \rightarrow
\abs{\fix{\dcframe{A_{\McF{}}}}{\RHD}}$ on the underlying posets. We will define a
notion of $f$ representing $\McF{}$ in $F$.

\begin{defn}[Representation]\label{defn:rep}
  Given a formal topology $\mathcal{F} \equiv (A, B, C, d)$, a frame $F$, and a function
  $\oftyI{f}{A \rightarrow \abs{F}}$, we say that $f$ represents $\mathcal{F}$ in $F$ if the
  following type is inhabited:
  \begin{equation*}
    \represents{\mathcal{F}}{F}{f} \quad\is\quad
      \pity{a}{A}{
        \pity{b}{B(x)}{
          f(a) \sqsubseteq \bigvee_{\oftyI{c}{C(a, b)}} f(d(a, b, c)).
        }
      }
  \end{equation*}
\end{defn}

It can be shown that the opposite direction of the inequality asserted by $\representsnm$
always holds. To assert $\represents{\McF}{F}{f}$ is then to assert
\begin{equation*}
  \pity{a}{A}{\pity{b}{B(x)}{f(a) = \bigvee_{\oftyI{c}{C(a, b)}} f(d(a, b, c))}}.
\end{equation*}
This property therefore expresses that $R$ behaves like a model of the covering relation
of the formal topology $\McF$, that is, the join of $R$ reflects the covering relation
induced by the formal-topological structure of $\McF$. This is the idea underlying the
name ``representation''.

To state the universal property, we will work with \emph{flat} monotonic maps. This is the
special case of the notion of a \emph{flat functor}~\cite{nlab-flat-functor} in the case
where the categories we are working with are posets. Consider a monotonic map $f : P \rightarrow Q$,
where $Q$ has finite meets but $P$ possibly does not. We would like to assert somehow that
$f$ preserves these finite meets but we cannot mention the meets of $P$ as they do not
exist. So we instead require $f$ to preserve those meets that \emph{do not exist yet}
which we can do by requiring the following conditions:
\begin{enumerate}
  \item $\top_Q = \bigvee \setof{ f(a) ~|~ \oftyI{a}{\abs{P}} }$, and
  \item $\pity{x~y}{P}{f(x) \wedge f(y) = \bigvee \setof{ f(z) ~|~ z \sqsubseteq x\ \text{and}\ z \sqsubseteq y }}$.
\end{enumerate}
In our case, we will be considering those monotonic maps whose codomains are frames.

\begin{defn}[Flat monotonic map]\label{defn:flat}
  Let $P$ be a poset and $F$ a frame. Denote by $I$ the type $\sigmaty{z}{\abs{F}}{z \sqsubseteq x \times
    z \sqsubseteq y}$. A monotonic map $f : P \rightarrow F$ from $P$ to the underlying poset of the frame is
  called \emph{flat} if the following type is inhabited:
  \begin{alignat*}{5}
    \isflat{f} \quad&\is\quad   && &&\top_F &&= &&\hspace{0.55em}\bigvee \setof{ f(a) ~|~ \oftyI{a}{\abs{P}} }\\
      &\hspace{0.53em}\times &&\pity{a~b}{\abs{P}}{&&f(a) \wedge f(b) &&= &&\bigvee_{\oftyI{(i, \_)}{I}} f(i)}.
  \end{alignat*}
\end{defn}

\begin{figure}
  \centering
  \caption[Universal property of formal topologies]{The universal property.}
  \begin{tikzcd}[row sep=40pt, column sep=40pt]\label{fig:comm-diag}
    \McF{} \arrow[swap, rd, "f"] \arrow[r, "\eta"]
      & \fix{\dcframe{A_{\McF{}}}}{\RHD} \arrow[d, dashed, "g"] \\
      & R
  \end{tikzcd}
\end{figure}

Using flat monotonic maps, the universal property can now be stated.

\begin{thm}[Universal property for formal topologies]\label{thm:univ-prop}
  Given any formal topology $\McF{}$, frame $R$, flat monotonic map $f : A_{\McF{}} \rightarrow R$
  from the underlying poset of $\McF{}$ to the underlying poset of $R$, that represents
  $\McF{}$ in $R$, there exists a unique \textbf{frame homomorphism}
  $\oftyI{g}{\framehomo{\fix{\dcframe{A_{\McF{}}}}{\RHD}}{R}}$ such that $f = g \circ
  \eta$, as summarised in Fig.~\ref{fig:comm-diag}

  We express this fully formally as follows. Let $L \is \fix{\dcframe{A_{\McF{}}}}{\RHD}$;
  \begin{align*}
    \pity{\McF{}}{\formaltopo{}_{n, n}}{
      &\pity{R}{\framety{n+1}{n}{n}}{
         \pity{f}{\mono{P}{R}}{
           \isflat{f} \rightarrow \represents{\McF{}}{F}{f} \rightarrow\\
             &\iscontr{\sigmaty{g}{L \rightarrow_f R}{f = g \circ \eta}}
        }
      }
    }.
  \end{align*}
\end{thm}

First, observe how $\iscontrnm{}$ (Defn.~\ref{defn:contr}) expresses ``there exists a
unique'' in the statement of this theorem. Given some type $A$ and a family of
propositions $\oftyI{B}{A \rightarrow \univ{}}$ on $A$, to assert
\begin{equation*}
  \iscontr{\sigmaty{x}{A}{B(x)}},
\end{equation*}
is to assert precisely the existence of some $\oftyI{c}{A}$ satisfying $B$ such that every
other $\oftyI{x}{A}$ satisfying $B$ is equal to $c$. This is the case due to the
propositionality of $B$. Furthermore, notice also that this statement is talking only
about formal topologies whose carrier levels and relation levels are the same. We have
preferred this to keep the level bureaucracy manageable. For instance, we would have to
generalise the levels of the powerset operator (Defn.~\ref{defn:pow}) to generalise these
levels. We believe that such generalisations are not essential for our purposes in this
thesis.

Before proceeding to the proof, let us first prove a lemma of key importance.

\begin{lemma}\label{lem:main}
  Let $\McF{}$ be a formal topology (with its cover denoted by $\covernm{}$) and let $L
  \is \fix{\dcframe{A_{\McF{}}}}{\RHD}$. For any $\oftyI{U}{L}$, it is the case that:
  \begin{equation*}
    U = \bigvee^L \setof{ \eta(u) ~|~ \mempow{u}{U} }.
  \end{equation*}
\end{lemma}
\begin{proof}
  Let $\oftyI{U}{L}$. We proceed by antisymmetry. The
  $U \sqsubseteq \bigvee^L \setof{ \eta(u) ~|~ u \mempownm U }$
  direction is immediate by an application of the $\ruledir{}$ rule. For the other
  direction, let $\oftyI{a}{A_{\McF{}}}$ and suppose that
      $\mempow{a}{\bigvee^L \setof{ \eta(u) ~|~ u \mempownm U }}$.
  Recall that the join operation of the frame of fixed points for a nucleus (Theorem
  \ref{thm:fixed-point-frame}) of some frame $F$ is defined by applying the nucleus on the
  join operator of $F$. This is to say that we have
  $\covers{a}{\bigcup \setof{ \eta(u) ~|~ u \mempownm U }}$. The result follows by induction on the
  proof of this fact, in the $\ruledir{}$ case of which Prop.~\ref{prop:lem4} and the
  induction principle of truncation are used.
\end{proof}

\begin{lemma}\label{lem:resp-join}
  Let $\McF{}$ be a formal topology and $R$ a frame and let $L$ denote
  $\fix{\dcframe{A_{\McF{}}}}{\RHD}$. Let $\oftyI{f}{\mono{P}{R}}$ be a \emph{flat}
  monotonic map that represents $\McF{}$ in $R$ (as defined in Defn.~\ref{defn:rep}).
  Given any $\oftyI{x}{A_{\McF}}$, and $\oftyI{U}{\sub{}{\abs{L}}}$ with index type $I$,
  if $x \mempownm \bigvee_L U$ then
  \begin{equation*}
    f(x)
    =
    \bigvee^R \setof{
          f(a) ~|~ (\_, (a, \_)) : \sigmaty{i}{I}{\sigmaty{a}{A_{\McF{}}}{a \mempownm U_i}}
        }
  \end{equation*}
\end{lemma}
\begin{proof}
  We proceed by antisymmetry. The ($\sqsupseteq$) direction easily follows by the LUB property.
  For the ($\sqsubseteq$) direction, it suffices to by the LUB property to show
  \begin{equation*}
    \pity{x}{A_{\McF}}{%
      x \mempownm \bigvee^L U \rightarrow f(x) \sqsubseteq
        \bigvee^R \setof{
              f(a) ~|~ (\_, (a, \_)) : \sigmaty{i}{I}{\sigmaty{a}{A_{\McF{}}}{a \mempownm U_i}}
            }
    }
  \end{equation*}
  Let $\oftyI{x}{A_{\McF}}$ such that $x \mempownm \bigvee^L U \rightarrow f(x)$. We proceed by induction
  on the proof of $x \mempownm \bigvee^L U \rightarrow f(x)$.
  \begin{itemize}
    \item Case $\ruledir{}$. Direct by the recursion principle of truncation and the
      fact that $\bigvee^R$ is an upper bound.
    \item Case $\rulebranch{}$. We have some experiment $\oftyI{b}{B(x)}$ such that for
      every $\oftyI{c}{C(x, b)}$, $\covers{d(x, b, c)}{U}$.
      \begin{alignat*}{3}
               & && f(x) &&                                   \\
        \quad&\sqsubseteq\quad   && \bigvee^R \setof{ f(d(x, b, c)) ~|~ c : C(x, b) }
               &&\quad [\text{$f$ represents}] \\
        \quad&\sqsubseteq\quad   && \bigvee^R \setof{ f(a) ~|~ (\_, (a, \_))
                            : \sigmaty{i}{I}{\sigmaty{a}{A_{\McF{}}}{a \mempownm U_i}}
                            }
               &&\quad [\text{LUB and IH}].
      \end{alignat*}
    \item Case $\rulesquash{}$. Follows by the propositionality of $\sqsubseteq_R$.
  \end{itemize}
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:univ-prop}]
  Let $\McF{}$ be a formal topology and $R$ a frame and let $L$ denote
  $\fix{\dcframe{A_{\McF{}}}}{\RHD}$. Let $\oftyI{f}{\mono{P}{R}}$ be a \emph{flat}
  monotonic map that represents $\McF{}$ in $R$ (as defined in Defn.~\ref{defn:rep}). We
  will show the \emph{unique existence} of a \emph{frame homomorphism}
  $\oftyI{g}{\framehomo{L}{R}}$ such that $f = g \circ \eta$.

  We choose
  \begin{align*}
    g    \quad&:\quad \abs{L} \rightarrow \abs{R}              \\
    g(U) \quad&\is\quad \bigvee^R \setof{ f(u) ~|~ u \mempownm U } .
  \end{align*}
  To show that the diagram commutes, it suffices by Proposition~\ref{prop:funext} to show
  $f(x) = g(\eta(x))$ for every $\oftyI{x}{A_{\McF{}}}$. Let $\oftyI{x}{A_{\McF{}}}$; we
  proceed by antisymmetry. The $f(x) \sqsubseteq g(\eta(x))$ direction is easy: $g(\eta(x)) = \bigvee^R f(\eta(x))$
  and $\bigvee^R$ is an upper bound of $f(\eta(x))$ so it suffices to show
  $f(x) \mempownm f(\eta(x))$. This is immediate since $x \mempownm \eta(x)$.

  The other direction is the interesting one. First, we prove a lemma in preparation:
  \emph{%
    given any $\oftyII{a}{a'}{A_{\McF{}}}$ such that $\covers{a'}{\lifta{a}}$, $f(a') \sqsubseteq
    f(a)$
  }.
  Let $\oftyII{a}{a'}{A_{\McF{}}}$ and assume $\covers{a'}{\lifta{a}}$. We proceed by
  induction on the proof of $\covers{a'}{\lifta{a}}$.
  \begin{itemize}
    \item Case: $\ruledir{}$. It must be that $a' \mempownm \lifta{a}$ which is to say $a'
      \sqsubseteq a$. We are then done by the monotonicity of $f$.
    \item Case: $\rulebranch{}$. There must be some $\oftyI{b}{B_{\McF{}}(a')}$ and a
      function $h$ such that $\oftyI{h(c)}{\covers{d(a', b, c)}{\lifta{a}}}$ for any
      $\oftyI{c}{C(a', b)}$. Notice that $f(a') \sqsubseteq \bigvee_{\oftyI{c}{C(a', b)}}f(d(a, b, c))$ by
      the assumption that $f$ \emph{represents} (Defn.~\ref{defn:rep}) so it remains to be
      shown $$\bigvee_{\oftyI{c}{C(a', b)}}f(d(a, b, c)) \sqsubseteq f(a).$$ As
      $\bigvee_{\oftyI{c}{C(a', b)}}f(d(a, b, c))$ is a LUB, it suffices to show that $f(a)$ is an
      upper bound of the subset of $A_{\McF{}}$ delineated by $f(d(a', b, \_))$.
      Consider $f(d(a', b, c))$ for some $c$. We have that
      $\oftyI{h(c)}{\covers{d(a', b, c)}{\lifta{a}}}$ meaning $f(d(a', b, c)) \sqsubseteq f(a)$ by
      the inductive hypothesis.
    \item Case $\rulesquash{}$. We combine the inductive hypotheses using the fact that
      the result type $f(a') \sqsubseteq f(a)$ is propositional.
  \end{itemize}

  Now, we want to show that $\bigvee^R f(\eta(x)) \sqsubseteq f(x)$. Since $\bigvee^R$ is a LUB it suffices to show
  that $f(x)$ is an upper bound of $\img{f}{\eta(x)}$. Let $$\memfam{f(y)}{\img{f}{\eta(x)}}.$$
  We need to show that $f(y) \sqsubseteq f(x)$. By the lemma we have just proven, it suffices to
  show that $\covers{y}{\lifta{x}}$ and this holds directly because
  $\memfam{f(y)}{\img{f}{\eta(x)}}$.

  There are two more things that have to be shown: (1) $g$ is a frame homomorphism and (2)
  $g$ is unique.

  Let us first address (1). The fact that $g$ is monotonic follows by the LUB property.
  The fact that $g$ preserves the top element of $L$ is given by the flatness assumption
  (Defn.~\ref{defn:flat}): $g(\top) = \bigvee^R \img{f}{A_{\McF{}}} = \top_R$. To see that $g$ also
  preserves binary meets, let $\oftyII{U}{V}{L}$. First, we show:
  \begin{equation}\label{eqn:pres-meet}
      \bigvee^R \{ f(a) ~|~ a \mempownm \intersect{U}{V} \}
    = \bigvee^R \setof{ \bigvee^R \{ f(w) ~|~ w \sqsubseteq u \times w \sqsubseteq v \} ~|~ (u, v) \mempownm U \times V }.
  \end{equation}
  This follows by antisymmetry. For the ($\sqsubseteq$) direction, it suffices by the fact that
  $\bigvee^R$ is a LUB, to show that
  \begin{equation*}
    \mathsf{RHS} \quad\is\quad
      \bigvee^R \setof{ \bigvee^R \{ f(w) ~|~ w \sqsubseteq u \times w \sqsubseteq v \} ~|~ (u, v) \mempownm U \times V }
  \end{equation*}
  is an upper bound of $\setof{ f(a) ~|~ \mempow{a}{U \capp V} }$. Let
  $\oftyI{a}{A_{\McF{}}}$ such that $a \mempownm U$ and $a \mempownm V$. The fact that
  $f(a) \sqsubseteq \mathsf{RHS}$ can be seen to hold by the LUB property of $\bigvee^R$. For the ($\sqsupseteq$)
  direction, it is sufficient, since $\bigvee^R$ is less than any other upper
  bound, to show that
  \begin{equation*}
    \bigvee^R \{ f(a) ~|~ a \mempownm \intersect{U}{V} \}
  \end{equation*}
  is an upper bound of
  \begin{equation*}
    \setof{ \bigvee^R \{ f(w) ~|~ w \sqsubseteq u \times w \sqsubseteq v \} ~|~ (u, v) \mempownm U \times V }.
  \end{equation*}
  This follows straightforwardly by the LUB property combined with the downwards-closure
  of $U$ and $V$. The result that $g$ preserves binary meets then follows as:
  \begin{align*}
    g(\intersect{U}{V}) &\equiv \bigvee^R \{ f(a) ~|~ a \mempownm \intersect{U}{V} \}
               && [\text{(\ref{eqn:pres-meet})}] \\
             &= \bigvee^R \setof{ \bigvee^R \{ f(w) ~|~ w \sqsubseteq u \times w \sqsubseteq v \} ~|~ (u, v) \mempownm U \times V }
               && [\text{flatness}]                                                 \\
             &= \bigvee^R \setof{ f(u) \wedge f(v) ~|~ (u, v) \mempownm U \times V }
               &&\text{[Prop.~\ref{prop:distr}]}                                    \\
             &= \left( \bigvee^R \setof{ f(u) ~|~ u \mempownm U } \right)
              \wedge \left( \bigvee^R \setof{ f(v) ~|~ v \mempownm V } \right)                 \\
             &\equiv g(U) \wedge g(V)                                                         .
  \end{align*}
  Let us now show that $g$ preserves joins. Let $U$ be a family of inhabitants of
  $\abs{L}$.
  \begin{align*}
    g(\bigvee^L U) &\equiv \bigvee^R \setof{ f(a) ~|~ a \mempownm \bigvee^L_i U_i }
                && [\text{Lemma~\ref{lem:resp-join}}]\\
    &= \bigvee^R \setof{ f(a) ~|~ \oftyI{(\_, (a, \_))}{\sigmaty{i}{I}{\sigmaty{x}{A_{\McF{}}}{x \mempownm U_i}}} }
                && [\text{Lemma~\ref{lem:flatten}}] \\
             &= \bigvee^R \setof{ \bigvee^R \img{f}{U_i} ~|~ \oftyI{i}{I} } \\
             &\equiv \bigvee^R \setof{ g(U_i) ~|~ U_i \mempownm U }.
  \end{align*}
  To be precise about the use of Lemma~\ref{lem:flatten}, we note that it used on the
  function:
  \begin{equation*}
    \lambda\_~(a, \_).~f(a).
  \end{equation*}

  Finally, we conclude the proof by showing uniqueness of $g$: let $g'$ be a frame
  homomorphism from $L$ to $R$ that makes the diagram commute. We need to show that
  $g = g'$. Let $\oftyI{U}{\abs{L}}$. $g(U) = g'(U)$ by the following equational proof:
  \begin{align*}
    g(U) &\equiv \bigvee^R \setof{ f(u) ~|~ u \mempownm U }
            &&\text{[$f = g' \circ \eta$]} \\
         &= \bigvee^R \setof{ g'(\eta(u)) ~|~ u \mempownm U }
            &&\text{[$g'$ is a frame homomorphism]} \\
         &= g'\left( \bigvee^L \setof{ \eta(u) ~|~ u \mempownm U } \right)
            &&\text{[Lemma~\ref{lem:main}]} \\
         &= g'(U).
  \end{align*}
  Note that we are making implicit use of Prop.~\ref{prop:to-subtype} as we are concluding
  $(g, p) = (g' , q)$ where $p$ and $q$ are the respective homomorphism proofs.
\end{proof}
