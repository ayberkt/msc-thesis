\chapter{Frames}\label{chap:frames}

We develop in this chapter the lattice-theoretic notion of a \emph{frame}. In
Chapter~\ref{chap:intro}, we explained that a frame is the algebra of a logic of finitely
verifiable properties. Recall that a frame consists of the following:
\begin{itemize}
  \item a set $O$ of \emph{opens},
  \item a partial order $\_\sqsubseteq\_ \subseteq O \times O$, corresponding to the set-inclusion order of the
    open subsets,
  \item finite meets, and
  \item arbitrary joins.
\end{itemize}

In addition to these, there is a law that is needed to ensure the correct interplay
between meets and joins. Suppose that we have a set $A$ and a family of sets $B_0, B_1,
\cdots$. Consider the expression:
\begin{equation*}
  A \cap (\bigcup_i B_i).
\end{equation*}
By set-theoretic reasoning, this is the same as:
\begin{equation*}
  \bigvee_i (\phi \wedge \psi_i).
\end{equation*}
As we are trying to characterise the behaviour of open ``sets'' without defining them as
sets of points, we have to explicitly add this distributivity law into the definition of
frame. Put simply:
\begin{center}
  \emph{binary meets must distribute over arbitrary joins in a frame.}
\end{center}

We now start presenting our formal development of frames. We start with partially ordered
sets in Section~\ref{sec:poset}, which underlie frames. In Section~\ref{sec:frame}, we
present the definition of a frame. In Section~\ref{sec:frame-univ}, we present an
important theorem unique to \UF{}: isomorphic frames are equal. In Sections
\ref{sec:down-set-frame} and \ref{sec:nuclei}, we prove two important theorems in
preparation for the Chapter~\ref{chap:formal-topo} on formal topology: (1) the set of
downwards-closed subsets of a poset forms a frame and (2) given a nucleus (a technical
notion to be introduced) on a frame, its set of fixed points is itself a frame.

\section{Partially ordered sets}\label{sec:poset}

This section corresponds to the \modname{Poset} module in the \veragda{} development.

\begin{defn}[Poset]\label{defn:poset}
  Given some $\oftyI{A}{\univ{}_m}$, let $\order{n}{A} \is A \rightarrow A \rightarrow \hprop{}_n$. A poset at
  carrier level $m$ and relation level $n$ is then defined as:
  \begin{equation*}
    \mathsf{Poset}_{m, n} \quad\is\quad \sigmaty{A}{\univ_m}{\posetstr{n}{A}},
  \end{equation*}
  \begin{center}
  where
  \end{center}
  \begin{align*}
    \posetstr{n}{A} \quad&\is\quad \sigmaty{R}{\order{n}{A}}{\posetax{A, R}}              \\
    \posetaxnm \quad&:\quad \pity{A}{\univ{}_m}{\order{n}{A} \rightarrow \univ_{\max(m, n)}}           \\
    \posetax{A, R} \quad&\is\quad ~~\pity{x}{A}{R(x, x)}                      \\
                    &\hspace{0.6em}\times \pity{x~y~z}{A}{R(x, y) \rightarrow R(y, z) \rightarrow R(x, z)} \\
                    &\hspace{0.6em}\times \hspace{0.3em}\pity{x~y}{A}{R(x, y) \rightarrow R(y, x) \rightarrow x =_A y}   \\
                    &\hspace{0.6em}\times \isaset{A}
  \end{align*}

  From now on, we will make levels implicit unless they are relevant to the discussion.
\end{defn}

Given a poset $P$, we will refer to its relation as $\_\sqsubseteq_P\_$ (in cases where there might
be ambiguity) and the underlying set of $P$ as $\abs{P}$. Notice that the fourth component
of $\posetax{A, R}$ requires the carrier set to be an \hyperref[defn:hset]{h-set}
(Defn.~\ref{defn:hset}).

Given a poset $P$ we will talk about its \emph{downward-closed subsets}: sets that include
all elements below their elements. This notion embodies the idea of verification at a
certain stage of information. Take a certain element $x : \abs{P}$, that we view as a
stage of information. For some other $y~:~\abs{P}$, $y \sqsubseteq x$ expresses the idea that $y$ is
a \emph{finer} stage of information i.e., it contains more information hence admitting
\emph{less}. Let $U$ be a subset of $\abs{P}$. The property that $U$ is downward-closed is
then nothing but:
\begin{equation*}
  x \in U \rightarrow y \sqsubseteq x \rightarrow y \in U,
\end{equation*}
the intuitive reading of which is: $U$ contains all stages that are ramifications of the
stages it contains. This is another way of saying that $U$ is an \emph{observable}
property: when we find an element $x$ contained in $U$, all possible ways $x$ can proceed
are guaranteed to stay in $U$ i.e, the reception of more information does not disrupt the
property $U$.

Let us summarise this in formal terms.
\begin{defn}[Downward-closed subset]\label{defn:dc-subset}
  We first define a predicate expressing that a given subset of $P$ is downwards-closed:
  \begin{align*}
    \isdcnm{}   &\quad:\quad  Poset_{m, n} \rightarrow \pow{\abs{P}} \rightarrow \Omega_{\max(m, n)}\\
    \isdc{P, U} &\quad\is{}\quad \pity{x~y}{\abs{P}}{x \in U \rightarrow y \sqsubseteq x \rightarrow y \in U}.
  \end{align*}
  The propositionality follows by Proposition~\ref{prop:pi-prop}.

  We then define the type of downwards-closed subsets of a poset as:
  \begin{align*}
    \dcsubsetnm{} &\quad:\quad \mathsf{Poset} \rightarrow \univ{}                     \\
    \dcsubset{P}  &\quad\is{}\quad \sigmaty{U}{\pow{\abs{P}}}{\isdc{P, U}}  .
  \end{align*}
\end{defn}

So far we have dealt with two notions of \emph{observable property} throughout the
development:
\begin{enumerate}
  \item elements of a poset which we will view as opens when we get to frames, and
  \item the notion of downwards-closed subset which expresses that a property of the poset
    of opens behaves like an observable property.
\end{enumerate}
We will now start relating these two by showing that the set of downwards-closed subsets
of a poset is itself a poset, and indeed, we will prove later (in
Sec.~\ref{sec:down-set-frame}) that it actually forms a frame meaning downwards-closed
subsets satisfy our expectations from properties we view as observable.

Let us start by showing that $\dcsubset{P}$ is always a set.
\begin{prop}\label{isSetDCSubset}
  $\dcsubset{P}$ is a set for every poset $P$.
\end{prop}
\begin{proof}
  By Proposition~\ref{prop:sigma-set}, it suffices to show that $\pow{\abs{P}}$ is a set
  and $$\isdc{P, U}$$ is a set for every $\oftyI{U}{\pow{\abs{P}}}$. The former holds by
  Proposition~\ref{prop:pow-set}. For the latter, observe that every $\isdc{P, U}$ is a
  proposition by definition meaning it is also set by Proposition~\ref{prop:prop-is-set}.
\end{proof}

Now we can proceed to construct the poset of downwards-closed subsets.
\begin{prop}(Poset of downward-closed subsets)\label{prop:dc-poset}
  Let $P$ be a poset. The type $\dcsubset{P}$ forms a poset under the
  inclusion relation.
\end{prop}
\begin{proof}
  The fact that $\dcsubset{P}$ is a set is given by Proposition~\ref{isSetDCSubset} so it
  suffices to show that the poset axioms are satisfied. Reflexivity and transitivity are
  immediate. For antisymmetry, let $U, V \in \pow{\abs{P}}$ and assume $U \subseteq V$, $V \subseteq U$. By
  function extensionality, it suffices to show, for every $x : \abs{P}$, $U(x) = V(x)$.
  Since $\oftyII{U(x),}{V(x)}{\Omega}$, it is sufficient to show $U(x) \leftrightarrow V(x)$ which is
  immediate by assumptions.
\end{proof}

\subsection{Monotonic functions}

Let us now write down the arrows between posets: monotonic maps.
\begin{defn}[Monotonic function]\label{defn:mono-map}
  Let $P, Q$ be posets. A function $f : \abs{P} \rightarrow \abs{Q}$ is monotonic if the following
  type is inhabited:
  \begin{equation*}
    \ismonotonic{f} \quad\is\quad \pity{x~y}{\abs{P}}{x \sqsubseteq_P y \rightarrow f(x) \sqsubseteq_Q f(y)}.
  \end{equation*}

  We collect the type of monotonic functions between $P$ and $Q$ in the following type:
  \begin{equation*}
    \mono{P}{Q} \quad\is\quad \sigmaty{f}{\abs{P} \rightarrow \abs{Q}}{\ismonotonic{f}}
  \end{equation*}
\end{defn}

\begin{defn}[Poset isomorphism]
  An isomorphism between two posets is a monotonic function with a monotonic inverse.
\end{defn}

\section{Definition of a frame}\label{sec:frame}

We now proceed to define frames as discussed. The constructions presented here can be
found in the \modname{Frame} module in the \veragda{} formalisation.
\begin{defn}[Frame]\label{defn:frame}
  A frame structure on some type $A$ consists of (1) a poset structure, (2) a top element,
  (3) a binary meet operation, and (4) a join operation of arbitrary arity, which we
  define using families. A \emph{raw} frame structure (i.e., the data involved in defining
  a frame, without the axioms) with relation level $n$ and index level $o$ is defined as:
  \begin{equation*}
    \rawframestr{n}{o}{A} \quad\is\quad \posetstr{n}{A} \times A \times (A \rightarrow A \rightarrow A) \times (\sub{o}{A} \rightarrow A).
  \end{equation*}
  This raw structure must be subject to the following axioms.
  \begin{alignat*}{2}
    \frameax{\sqsubseteq, \top, \wedge, \bigvee} \quad&\is\quad             &&\mathsf{isTop}(\top) \times
                                              \mathsf{isGLB}(\wedge) \times
                                              \mathsf{isLUB}\left( \bigvee \right)\\
                          &\hspace{0.55em}\times &&\mathsf{isDistr}\left( \wedge, \bigvee \right)
  \end{alignat*}
  where
  \begin{alignat*}{2}
    \mathsf{isTop}(\top) \quad&\is\quad &&\pity{x}{A}{x \sqsubseteq \top}\\
    \mathsf{isGLB}(\wedge) \quad&\is\quad &&\pity{x~y}{A}{(x \wedge y \sqsubseteq x) \times (x \wedge y \sqsubseteq y)}\\
                       &\hspace{0.55em}\times &&\pity{z~~}{A}{(z \sqsubseteq x) \times (z \sqsubseteq y) \rightarrow z \sqsubseteq x \wedge y}\\
    \mathsf{isLUB}\left(\bigvee\right) \quad&\is\quad
         &&\pity{U}{\sub{o}{A}}{\pity{x}{A}{\memfam{x}{U} \rightarrow x \sqsubseteq \bigvee_i U_i}}\\
         &\hspace{0.55em}\times &&\pity{U}{\sub{o}{A}}{\pity{x}{A}{
        \left( \pity{y}{A}{\memfam{y}{U} \rightarrow y \sqsubseteq x}\right) \rightarrow \bigvee U \sqsubseteq x }}\\
    \mathsf{isDistr}(\wedge, \bigvee) \quad&\is\quad
      &&\pity{x}{A}{\pity{U}{\sub{o}{A}}{
          x \wedge \bigvee_i U_i} =_A \bigvee_i \left( x \wedge U_i \right)
      }
  \end{alignat*}
\end{defn}

We will use the notation $\abs{F}$ for referring to the underlying set of a frame, as we
do for posets. Similarly, we will refer to the underlying partial order as $\_\sqsubseteq_F\_$, the
join operator as $\bigvee^F$ and the meet operator as $\wedge_F$. When speaking of a certain frame,
we will refer colloquially to its underlying poset. We will formally notate this as
$\posof{F}$.

\begin{prop}
  For every raw frame structure $(\sqsubseteq, \top, \wedge, \bigvee)$, $\frameax{\sqsubseteq, \top, \wedge, \bigvee}$ is a proposition.
\end{prop}
\begin{proof}[Proof sketch]
  By Proposition~\ref{prop:sigma-prop}, it suffices to show that each component is an
  h-prop. For $\mathsf{isTop}$, $\mathsf{isGLB}$, and $\mathsf{isLUB}$ this can be
  concluded by using Proposition~\ref{prop:sigma-prop} and Proposition~\ref{prop:pi-prop}.
  For $\mathsf{isDistr}$, we use Proposition~\ref{prop:pi-prop} followed by the fact that
  the underlying set of a poset is an h-set (by the definition of $\posetaxnm{}$ from
  Definition~\ref{defn:poset}).
\end{proof}

\subsection{Frame homomorphisms}

As we have just introduced a new structure, we shall define what it means for a function
to preserve this structure.

\begin{defn}[Frame homomorphism]\label{defn:frame-homo}
  Let $F$ and $G$ be frames with the same index level. A frame homomorphism from $F$ to
  $G$ is a monotonic map (Defn.~\ref{defn:mono}) from the underlying poset of $F$ to the
  underlying poset of $G$ that preserves the top element, the meets, and the joins.
  Formally,
  \begin{alignat*}{5}
    \isframehomo{f} \quad&\is\quad && &&f(\top_F) &&\idnm{} &&f(\top_G) \\
      &\hspace{0.55em}\times\quad  &&\pity{x~y}{\abs{F}}{&&f(x \wedge_F y) &&\idnm{} &&f(x) \wedge_G f(y)} \\
      &\hspace{0.55em}\times\quad  &&\pity{U}{\sub{o}{\abs{F}}}{&&f(\bigvee^F U) &&\idnm{} &&\bigvee^G \setof{ f(x) ~|~ x \in U }}.
  \end{alignat*}

  The type of frame homomorphisms between $F$ and $G$ is then just:
  \begin{equation*}
    \framehomo{F}{G} \quad\is\quad \sigmaty{f}{\mono{\posof{F}}{\posof{G}}}{\isframehomo{f}}.
  \end{equation*}
\end{defn}

\section{Some properties of frames}

\begin{lemma}[Flattening lemma]\label{lem:flatten}
  Let $\oftyI{F}{\framety{m}{n}{o}}$ and let $\oftyI{f}{\pity{a}{A}{B(a) \rightarrow \abs{F}}}$ for
  some $\oftyI{A}{\univ{}_o}$ and $\oftyI{B}{A \rightarrow \univ{}_o}$. The following equality
  holds:
  \begin{equation*}
      \bigvee^F \setof{ \bigvee^F \setof{ f(a, b) ~|~ b \in B(a) } ~|~ \oftyI{a}{A}          }
    = \bigvee^F \setof{ f(a, b)             ~|~ \oftyI{(a, b)}{\sigmaty{x}{A}{B(x)}} }.
  \end{equation*}
\end{lemma}

We omit the proof of Lemma~\ref{lem:flatten} as its content is not particularly
interesting and involves a non-trivial amount of bureaucracy. It can be found in the
\veragda{} formalisation, in the \modname{Frame} module; the constructed inhabitant is
named \fnname{flatten}.

\begin{prop}[Symmetric distributivity]\label{prop:distr}
  Let $\oftyI{F}{\framety{m}{n}{o}}$ and $\oftyII{U}{V}{\sub{o}{\abs{F}}}$. Call the index
  types of $U$ and $V$, $I$ and $J$, respectively. The following equality holds:
  \begin{equation*}
      \left( \bigvee_i U_i \right) \wedge \left( \bigvee_i V_i \right)
    = \bigvee \setof{ U_i \wedge V_j ~|~ \oftyI{(i, j)}{I \times J} }.
  \end{equation*}
\end{prop}
\begin{proof}[Proof sketch]
  Apply the distributivity law, use commutativity (\todo{reference}), apply the
  distributivity law again, and then flatten (using Lemma~\ref{lem:flatten}).
\end{proof}

\section{Isomorphic frames are equal}\label{sec:frame-univ}

\todo{
  Prove that isomorphic frames are equal using the structure identity principle developed
  in Section~(\todo{reference}). This will consist in showing that definition of a frame
  with frame isomorphism forms a standard notion of structure and that frame axioms are
  propositions.
}

\section{Frame of downwards-closed subsets}\label{sec:down-set-frame}

We have shown, in Theorem~\ref{prop:dc-poset}, how to construct the poset of
downwards-closed subsets of a given poset. We will now show that this poset forms a
\emph{frame} with subset intersection and subset union.

\begin{thm}\label{thm:down-set-frame}
  Given a poset $P$, the poset of downwards-closed subsets of $P$ (as constructed in
  Theorem~\ref{prop:dc-poset}), is a frame.
\end{thm}
\begin{proof}
  We start by defining the following $\top, \wedge, and \bigvee$ operations:
  \begin{align*}
    \top       \quad&\is\quad \top_A   && \text{(as in Defn.~\ref{defn:entire-subset})} \\
    U \wedge V   \quad&\is\quad \intersect{U}{V} && \text{(as in Defn.~\ref{defn:intersection})}\\
    \bigvee \bF{} \quad&\is\quad \lambda x.~ \trunc{\sigmaty{i}{\indexset{\bF{}}}{x \epsilon \bF{}_i}}
                         && \text{(using truncation as defined in Defn.~\ref{defn:truncation})}
  \end{align*}
  $\top$ and $\cap$ are propositional by construction whereas $\bigvee$ requires a truncation to be
  forced to be propositional. Downwards-closure and the LUB/GLB properties are easy to
  verify. We focus on showing that the distributivity law is satisfied. Let $U$ be a
  downwards-closed subset and $\bF{}$, a family of downward-closed subsets. We must show
  \begin{align*}
    U \cap \left(\lambda x.~ \trunc{\sigmaty{i}{\indexset{\bF{}}}{x \epsilon \bF{}_i}}\right)
      &= \bigvee \left( U \cap \left( \lambda x.~ \trunc{\sigmaty{i}{\indexset{\bF{}}}{x \epsilon \bF{}_i}}\right) \right)\\
      &\equiv \bigvee \left( \lambda x.~ \trunc{\sigmaty{i}{\indexset{\bF{}}}{x \epsilon \bF{}_i}} \times x \epsilon U \right)
  \end{align*}
  which follows by antisymmetry.

  We will denote the frame of downwards-closed subsets of poset $P$ as $P\downarrow$.

  \todo{revise and expand}.
\end{proof}

There is an obvious ``lifting'' (monotonic) map from poset $P$ to $P\downarrow$ that takes an
element of $P$ to the set of elements below it.

\begin{defn}[Downwards-closure of an element]\label{defn:down-clos}
  Given a poset $P$, some $\oftyI{x}{P}$, the downwards-closure of $x$ is defined as:
  \begin{align*}
    \_\downarrow \quad&:\quad P \rightarrow P\downarrow                   \\
    x\downarrow  \quad&\is\quad \_ \sqsubseteq x  .
  \end{align*}
  This of course a downwards-closed set by construction.

  \todo{prove monotonicity.}
\end{defn}

\section{Nuclei and their fixed points}\label{sec:nuclei}

To prepare for formal topology, we will now define a technical notion called a
\emph{nucleus}. Nuclei are used to describe quotient frames of a frame, which one views as
subspaces of the space corresponding to that frame. They are presented by Johnstone
in~\cite[Sec.~II.2]{stone-spaces}.

The reason we are interested in nuclei is that in Chapter~\ref{chap:formal-topo} we will
be focusing on a particular nucleus on the frame of downward-closed subsets. It is this
nucleus that will allow us to describe the topological structure of our frame by letting
us specify laws that are expected to hold in the resulting frame.
\begin{defn}[Nucleus]\label{defn:nucleus}
  Let $F : \mathsf{Frame}_{m, n, o}$ and $j : \abs{F} \rightarrow \abs{F}$ and endofunction on it.
  We say that $j$ is \emph{nuclear} if the following condition holds:
  \begin{alignat*}{4}
    \isnuclearnm{}\quad&:\quad &&(\abs{F} \rightarrow \abs{F}) \rightarrow \Omega && &&              \\
    \isnuclear{j} \quad&\is\quad
       &&\pity{x~y}{\abs{F}}{j(\meet{x}{y}) &&~=~ &&\meet{j(x)}{j(y)}}  \\
      &\hspace{0.3em}\times\quad &&\pity{x~~}{\abs{F}}{x &&~\sqsubseteq~ &&j(x)}           \\
      &\hspace{0.3em}\times\quad &&\pity{x~~}{\abs{F}}{j(j(x)) &&~\sqsubseteq~ &&j(x)}.
  \end{alignat*}
  The propositionality is, as usual, a consequence of Proposition~\ref{prop:sigma-prop},
  Proposition~\ref{prop:pi-prop}, and the fact that the carrier set is a set (by the
  definition of $\posetaxnm{}$ from Defn.~\ref{defn:poset}).

  The type of nuclei is then just the $\sum$ type collecting all nuclear endofunctions on a
  frame:
  \begin{equation*}
    \mathsf{Nucleus} \quad\is\quad \sigmaty{j}{\abs{F} \rightarrow \abs{F}}{\isnuclear{j}}.
  \end{equation*}
\end{defn}


A notation clarification before we proceed: in a context involving a nucleus, we will
simply refer to these three nuclearity properties as $N_0$, $N_1$ and $N_2$.

Notice that everyy nucleus is monotonic.
\begin{prop}\label{prop:nucleus-mono}
  Every nucleus is monotonic.
\end{prop}
\begin{proof}
  Let $F$ be a frame and $j : \abs{F} \rightarrow \abs{F}$ a nucleus on it. Let
  $\oftyII{x}{y}{\abs{F}}$ and suppose $x \sqsubseteq y$. We need to show that $j(x) \sqsubseteq j(y)$. First,
  notice that $x = \meet{x}{y}$ by antisymmetry since $\meet{x}{y} \sqsubseteq x$ and $x \sqsubseteq
  \meet{x}{y}$ as $\meet{x}{y}$ is greater than any other lower bound and $x$ is a lower
  bound as it is less than both itself and $y$.
  \begin{align*}
    j(x) &\quad\sqsubseteq\quad j(\meet{x}{y})                 && [x = \meet{x}{y}]                      \\
         &\quad\sqsubseteq\quad \meet{j(x)}{j(y)}              && [\text{nuclei preserve meets}]         \\
         &\quad\sqsubseteq\quad {j(y)}                         && [\text{$\meet{}{}$ is a lower bound}]  .
  \end{align*}
\end{proof}

We will be interested in the type of inhabitants of a frame that are \emph{fixed} points
for a given nucleus on the frame, i.e., given a frame $F$ and a nucleus $j$ on it,
the type $$\sigmaty{x}{F}{j(x) = x}.$$

\begin{prop}
  The set of fixed points of a nucleus forms a poset.
\end{prop}
\begin{proof}[Proof sketch]
  The proof amounts to forgetting the information of being a fixed point. For
  antisymmetry, we use Proposition~\ref{prop:sigma-prop} along with the fact that the
  carrier set is an h-set (by the definition of $\posetaxnm{}$ from
  Defn.~\ref{defn:poset}).
\end{proof}

Now, we are ready to prove the main theorem of this section: this poset of fixed points
for a nucleus on a frame is itself a frame. The proof we will present has been adapted to
the type-theoretic setting from Johnstone's proof in \cite[II.2.2, pg.~49]{stone-spaces}.

\begin{thm}\label{thm:fixed-point-frame}
  The set of fixed points for a nucleus $j$ on some frame $F$ forms a frame.
\end{thm}
\begin{proof}
  The binary meets and the top element are taken directly from the frame $F$. The fact
  that the top element is a fixed point of $j$ is easy to verify: $\top \sqsubseteq j(\top)$ by nuclearity
  (Defn.~\ref{defn:nucleus}). For the meet operation, let $\oftyII{x}{y}{\abs{F}}$ such
  that $j(x) = x$ and $j(y) = y$. $x \wedge y \sqsubseteq j(x \wedge y)$ by $N_1$ so it suffices to show $j(x
  \wedge y) \sqsubseteq x \wedge y$. Nuclei preserve meets so $j(x \wedge y) = j(x) \wedge j(y) \sqsubseteq j(x) = x$ and $j(x \wedge
  y) = j(x) \wedge j(y) \sqsubseteq j(y) = y$. This means that $j(x \wedge y)$ is an upper bound of $x$ and
  $y$ hence $j(x \wedge y) \sqsubseteq x \wedge y$.

  We define the LUB on a family $\mathbf{G}$, making use of the LUB $\bigvee^F$ of $F$ but
  applying $j$ on the result:
  \begin{equation*}
    \bigvee \mathbf{G} \quad\is\quad j \left( \bigvee^F \mathbf{G} \right).
  \end{equation*}
  Notice that this is a LUB operator. Let $\bG{}$ be a family of fixed points for $j$ and
  let $x~\epsilon~\bG{}$. $\bigvee^F \mathbf{G}$ is an upper bound of $\bG{}$ so $x \sqsubseteq \bigvee^F \mathbf{G}$.
  Notice also that $\bigvee^F \mathbf{G} \sqsubseteq j \left( \bigvee^F \mathbf{G} \right)$ by ($N_1$). This
  means that $\bigvee$ is an upper operator. Let $u$ be some other upper bound of $\bG{}$ such
  that $j(u) = u$. We need to show that $j \left( \bigvee^F \mathbf{G} \right) \sqsubseteq u$. Since $u =
  j(u)$ it suffices by the monotonicity of $j$ (Prop.~\ref{prop:nucleus-mono}) to show
  $\bigvee^F \mathbf{G} \sqsubseteq u$. As $\bigvee^F \bG{}$ is a LUB, we are done since $u$ is an upper bound
  of $\bG{}$

  It remains to be shown that the infinite distributivity law is satisfied. Let
  $\oftyI{x}{\abs{F}}$ such that $j(x) = x$ and let $\bG{}$ be a family.
  \begin{align*}
    x \wedge \left( \bigvee \bG{} \right)
      &\quad\equiv\quad x    \wedge j\left( \bigvee^F \bG{} \right)      && [x = j(x)]                     \\
      &\quad=\quad j(x) \wedge j\left( \bigvee^F \bG{} \right)      && [N_1]                          \\
      &\quad=\quad j \left( x \wedge \bigvee^F \bG{} \right)        && [\text{distributivity of}\ F]  \\
      &\quad=\quad j \left( \bigvee^F_i x \wedge \bG{}_i \right)                                      \\
      &\quad\equiv\quad \bigvee_i x \wedge \bG{}_i
  \end{align*}
\end{proof}

We can also notice now that the codomain of the $_\downarrow$ map (Defn.~\ref{defn:down-clos}) is
restricted

In the next chapter, we will make use of nuclei to a generate a frame from a formal
topology.

%% \begin{code}
%% {-# OPTIONS --cubical #-}

%% open import basis

%% Order : (ℓ₁ : Level) → Type ℓ → Type (ℓ ⊔ suc ℓ₁)
%% Order ℓ₁ A = A → A → hProp ℓ₁

%% isReflexive : {A : Type ℓ₀} → Order ℓ₁ A → hProp (ℓ₀ ⊔ ℓ₁)
%% isReflexive {A = X} _⊑_ =
%%   ((x : X) → x ⊑ x is-true) , ∏-prop λ x → is-true-prop (x ⊑ x)

%% isTransitive : {A : Type ℓ₀} → Order ℓ₁ A → hProp (ℓ₀ ⊔ ℓ₁)
%% isTransitive {ℓ₀ = ℓ₀} {ℓ₁ = ℓ₁} {A = X} _⊑_ = φ , φ-prop
%%   where
%%     φ        : Type (ℓ₀ ⊔ ℓ₁)
%%     φ        = (x y z : X) → (x ⊑ y ⇒ y ⊑ z ⇒ x ⊑ z) is-true
%%     φ-prop   : isProp φ
%%     φ-prop   = ∏-prop λ x → ∏-prop λ y → ∏-prop λ z →
%%                  is-true-prop (x ⊑ y ⇒ y ⊑ z ⇒ x ⊑ z)

%% isAntisym : {A : Type ℓ₀} → IsSet A → Order ℓ₁ A → hProp (ℓ₀ ⊔ ℓ₁)
%% isAntisym {ℓ₀ = ℓ₀} {ℓ₁ = ℓ₁} {A = X} A-set _⊑_ = φ , φ-prop
%%   where
%%     φ        : Type (ℓ₀ ⊔ ℓ₁)
%%     φ        = (x y : X) → (x ⊑ y) is-true → (y ⊑ x) is-true → x ≡ y
%%     φ-prop   : isProp φ
%%     φ-prop   = ∏-prop λ x → ∏-prop λ y → ∏-prop λ p → ∏-prop λ q → A-set x y

%% PosetAx : (ℓ₁ : Level) (A : Type ℓ₀) → Order ℓ₁ A → hProp (ℓ₀ ⊔ ℓ₁)
%% PosetAx {ℓ₀ = ℓ₀} ℓ₁ A _⊑_ = φ , φ-prop
%%   where
%%     isPartial  : IsSet A → hProp (ℓ₀ ⊔ ℓ₁)
%%     isPartial  = λ hset → isReflexive _⊑_ ∧ isTransitive _⊑_ ∧ isAntisym hset _⊑_
%%     φ          = Σ[ A-set ∈ IsSet A ] (isPartial A-set) is-true
%%     φ-prop     = isOfHLevelΣ 1 isPropIsSet (is-true-prop ∘ isPartial)

%% PosetStr : (ℓ₁ : Level) → Type ℓ → Type (ℓ ⊔ suc ℓ₁)
%% PosetStr ℓ₁ = add-to-structure (Order ℓ₁) (λ A RP → PosetAx ℓ₁ A RP is-true)

%% Poset : (ℓ₀ ℓ₁ : Level) → Type (suc ℓ₀ ⊔ suc ℓ₁)
%% Poset ℓ₀ ℓ₁ = Σ (Type ℓ₀) (PosetStr ℓ₁)
%% \end{code}

%% The {\color{AgdaFunction} \texttt{add-to-structure}} function is imported from the
%% \texttt{cubical} library. It is a direct implementation of Mart\'{i}n Escard\'{o}'s
%% SIP~\cite[Sec.~3.33.1]{escardo-uf-intro}.

%% It would have been more idiomatic to use records to represent posets in Agda. $\sum$ types
%% have been used to avoid repeating h-level theorems such as
%% Proposition~\ref{prop:sigma-set}.
